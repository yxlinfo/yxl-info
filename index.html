<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>YXL 정보 허브</title>
  <meta name="description" content="YXL 누적/시즌/시너지 대시보드" />
  <link rel="stylesheet" href="styles.css" />
</head>
<!-- BGM (처음엔 재생 안 함: 사용자 터치 후 play) -->
<audio id="bgm" src="assets/bgm.mp3" preload="auto" loop></audio>

<!-- 터치/클릭 유도 오버레이 -->
<div id="bgmOverlay" style="
  position:fixed; inset:0; z-index:9999;
  display:flex; align-items:center; justify-content:center;
  background:rgba(0,0,0,.70);
  backdrop-filter: blur(6px);
">
  <button id="bgmStartBtn" type="button" style="
    padding:14px 18px; border-radius:16px;
    border:1px solid rgba(255,255,255,.25);
    background:rgba(255,255,255,.12);
    color:#fff; font-size:16px; cursor:pointer;
  ">
    ▶ 터치해서 음악 재생
  </button>
</div>

<!-- (선택) 재생/정지 토글 버튼 -->
<button id="bgmToggle" type="button" style="
  position:fixed; right:16px; bottom:16px; z-index:9998;
  padding:10px 14px; border-radius:12px;
  border:1px solid rgba(255,255,255,.25);
  background:rgba(0,0,0,.55); color:#fff; cursor:pointer;
  display:none;
">⏸ 음악</button>

<script>
(() => {
  const audio   = document.getElementById('bgm');
  const overlay = document.getElementById('bgmOverlay');
  const startBtn= document.getElementById('bgmStartBtn');
  const toggle  = document.getElementById('bgmToggle');

  // 기본 설정
  audio.volume = 0.25;

  // 한 번 재생 허용 받았는지 저장 (다음 방문 때 오버레이 스킵 가능)
  const KEY = 'yxl_bgm_enabled';

  const showOverlay = () => overlay.style.display = 'flex';
  const hideOverlay = () => overlay.style.display = 'none';

  const setTogglePlaying = (isPlaying) => {
    toggle.style.display = 'block';
    toggle.textContent = isPlaying ? '⏸ 음악' : '▶ 음악';
  };

  const start = async () => {
    try {
      await audio.play();            // 사용자 제스처 안에서 호출해야 안정적
      localStorage.setItem(KEY, '1');
      hideOverlay();
      setTogglePlaying(true);
    } catch (e) {
      // 일부 환경에서 실패 시 오버레이 유지
      showOverlay();
    }
  };

  // 1) 첫 방문: 오버레이 띄우고 버튼/화면 탭으로 시작
  // 2) 이전에 "허용"한 방문자: 오버레이는 숨기고, 첫 클릭/터치에 바로 시작(또는 버튼으로)
  const enabled = localStorage.getItem(KEY) === '1';
  if (enabled) {
    hideOverlay();
    // 그래도 "첫 제스처"가 필요할 수 있으니, 페이지 어디든 한 번 누르면 시작되게
    window.addEventListener('pointerdown', start, { once: true });
    window.addEventListener('keydown', start, { once: true });
    setTogglePlaying(false);
  } else {
    showOverlay();
  }

  // 오버레이 버튼 클릭(= 사용자 제스처 확보)
  startBtn.addEventListener('click', start);
  // 오버레이 영역 아무 데나 눌러도 시작되게
  overlay.addEventListener('pointerdown', (e) => {
    // 버튼 클릭이 아닌 오버레이 클릭도 허용
    if (e.target === overlay) start();
  });

  // (선택) 토글 버튼
  toggle.addEventListener('click', async () => {
    if (audio.paused) {
      await start();
    } else {
      audio.pause();
      setTogglePlaying(false);
    }
  });
})();
</script>
<audio id="bgm" src="assets/bgm.mp3" preload="auto" loop></audio>

<body>
  <!-- Header -->
  <header class="header">
    <div class="wrap header-inner">
      <div class="brand">
        <div class="brand-mark">YXL</div>
        <div class="brand-text">
          <div class="brand-title" id="siteTitle">YXL 정보 허브</div>
          <div class="brand-sub" id="siteSub">누적 · 시즌 · 시너지 한방 정리</div>
        </div>
      </div>

      <div class="header-actions">
        <button class="btn ghost" id="copyBtn" type="button">링크 복사</button>
        <span class="updated">업데이트: <b id="updatedAt">-</b></span>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="wrap">
    <!-- (선택) 간단 네비게이션 -->
    <section class="section" id="info">
      <div class="section-head">
        <h2>정보</h2>
        <p class="muted">아래 탭 버튼으로 대시보드를 전환해서 확인할 수 있어요.</p>
      </div>
    </section>

    <!-- Dashboards -->
    <section class="section" id="dashboards">
      <div class="section-head">
        <h2>대시보드</h2>
        <p class="muted">누적/시즌/시너지 탭을 눌러 전환하세요.</p>
      </div>

      <!-- 탭 버튼 -->
      <div class="dash-tabs" role="tablist" aria-label="대시보드 선택">
        <button class="dash-tab is-active" role="tab"
          aria-selected="true" aria-controls="dash-total"
          data-target="dash-total" type="button">
          누적 기여도표
        </button>

        <button class="dash-tab" role="tab"
          aria-selected="false" aria-controls="dash-season"
          data-target="dash-season" type="button">
          시즌별 기여도표
        </button>

        <button class="dash-tab" role="tab"
          aria-selected="false" aria-controls="dash-synergy"
          data-target="dash-synergy" type="button">
          시너지표
        </button>
      </div>

      <!-- 누적 -->
      <div class="dash-panel is-active" id="dash-total" role="tabpanel">
        <div class="card">
          <div class="card-head">
            <h3>누적 기여도표</h3>

            <div class="toolbar">
              <div class="input-wrap">
                <input id="totalSearch" class="input" type="text" placeholder="멤버 이름 검색" autocomplete="off">
              </div>
            </div>
          </div>

          <div class="table-wrap">
            <table class="table" id="totalTable">
              <thead>
                <tr>
                  <th style="width:92px;">순위</th>
                  <th>멤버</th>
                  <th class="num">기여도(별풍선)</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <p class="hint">* 1~3등은 특별 표시가 적용됩니다.</p>
        </div>
      </div>

      <!-- 시즌별 -->
      <div class="dash-panel" id="dash-season" role="tabpanel" hidden>
        <div class="card">
          <div class="card-head">
            <h3>시즌별 기여도표</h3>

            <div class="toolbar">
              <select id="seasonSelect" class="select"></select>

              <div class="input-wrap">
                <input id="seasonSearch" class="input" type="text" placeholder="멤버 이름 검색" autocomplete="off">
              </div>
            </div>
          </div>

          <div class="table-wrap">
            <table class="table" id="seasonTable">
              <thead>
                <tr>
                  <th style="width:92px;">순위</th>
                  <th>멤버</th>
                  <th class="num">기여도(별풍선)</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- 시너지 -->
      <div class="dash-panel" id="dash-synergy" role="tabpanel" hidden>
        <div class="card">
          <div class="card-head">
            <div>
              <h3 style="margin:0;">시너지표</h3>
              <p class="muted" style="margin:6px 0 0;">헤더를 클릭하면 해당 컬럼 기준으로 오름차순 정렬됩니다.</p>
            </div>
          </div>

          <div class="table-wrap">
            <table class="table sortable" id="synergyTable">
              <thead>
                <tr>
                  <th data-key="rank" style="width:92px;">순위</th>
                  <th data-key="grade">직급</th>
                  <th data-key="streamer">스트리머</th>
                  <th data-key="balloons" class="num">별풍선갯수</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="section" style="padding-top:10px;">
      <p class="muted" style="margin:0;">© YXL</p>
    </footer>
  </main>

  <script src="app.js"></script>
</body>
</html>
